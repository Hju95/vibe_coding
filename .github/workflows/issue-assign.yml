name: Issue Auto Assign

on:
  issues:
    types: [opened]

jobs:
  assign:
    runs-on: ubuntu-latest
    
    steps:
    - name: Auto Assign Issue
      uses: actions/github-script@v7
      with:
        script: |
          const { owner, repo, number } = context.issue;
          const issue = await github.rest.issues.get({
            owner,
            repo,
            issue_number: number,
          });
          
          const title = issue.data.title.toLowerCase();
          const body = (issue.data.body || '').toLowerCase();
          const author = issue.data.user.login;
          
          // íŒ€ì› ëª©ë¡ ë° ì „ë¬¸ ë¶„ì•¼ (í”„ë¡œì íŠ¸ì— ë§ê²Œ ìˆ˜ì • í•„ìš”)
          const teamMembers = {
            'Hju95': ['backend', 'api', 'database'], // ì‹¤ì œ GitHub ì‚¬ìš©ìëª…ìœ¼ë¡œ ë³€ê²½
            // 'frontend-dev': ['frontend', 'ui', 'streamlit'],
            // 'devops-engineer': ['deployment', 'ci', 'docker']
          };
          
          let assignee = null;
          
          // í‚¤ì›Œë“œ ê¸°ë°˜ ìë™ í• ë‹¹
          for (const [member, keywords] of Object.entries(teamMembers)) {
            for (const keyword of keywords) {
              if (title.includes(keyword) || body.includes(keyword)) {
                assignee = member;
                break;
              }
            }
            if (assignee) break;
          }
          
          // íŠ¹ì • í‚¤ì›Œë“œê°€ ì—†ìœ¼ë©´ ë¼ìš´ë“œë¡œë¹ˆ ë°©ì‹ìœ¼ë¡œ í• ë‹¹
          if (!assignee) {
            const members = Object.keys(teamMembers);
            const issueNumber = number;
            assignee = members[issueNumber % members.length];
          }
          
          // ì‘ì„±ì ë³¸ì¸ì´ë©´ ë‹¤ë¥¸ ì‚¬ëŒìœ¼ë¡œ í• ë‹¹
          if (assignee === author && Object.keys(teamMembers).length > 1) {
            const otherMembers = Object.keys(teamMembers).filter(m => m !== author);
            assignee = otherMembers[0];
          }
          
          if (assignee && assignee !== author) {
            try {
              await github.rest.issues.addAssignees({
                owner,
                repo,
                issue_number: number,
                assignees: [assignee]
              });
              
              console.log(`ì´ìŠˆ #${number}ì´ ${assignee}ì—ê²Œ í• ë‹¹ë˜ì—ˆìŠµë‹ˆë‹¤.`);
              
              // í• ë‹¹ ì•Œë¦¼ ì½”ë©˜íŠ¸
              await github.rest.issues.createComment({
                owner,
                repo,
                issue_number: number,
                body: `ğŸ¯ ì´ ì´ìŠˆê°€ @${assignee}ë‹˜ì—ê²Œ ìë™ í• ë‹¹ë˜ì—ˆìŠµë‹ˆë‹¤.\n\ní• ë‹¹ëœ ì´ìœ : ${title.includes('backend') || body.includes('backend') ? 'Backend ê´€ë ¨ ì´ìŠˆ' : title.includes('frontend') || body.includes('frontend') ? 'Frontend ê´€ë ¨ ì´ìŠˆ' : 'ìˆœì°¨ í• ë‹¹'}\n\n---\n*ìë™ í• ë‹¹ ì‹œìŠ¤í…œ ğŸ¤–*`
              });
              
            } catch (error) {
              console.log('ì´ìŠˆ í• ë‹¹ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error.message);
            }
          } else {
            console.log('í• ë‹¹í•  ì ì ˆí•œ ë‹´ë‹¹ìë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
          } 